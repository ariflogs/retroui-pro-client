import{h as P,u as D,r as u,e as S,j as e,C as m,b as y,t as x,R as T,i as f,k as v,X as R,T as h,l as k,m as M,B as N,f as j}from"./main-iiZPEbsr.js";import{L as C,I as z}from"./label-Cww25YmJ.js";import{R as V,T as A,D as B,P as H,C as I,a as $,O as _}from"./index-DXXsYYm5.js";import{V as J}from"./index-YliqMRm_.js";import"./index-BkVgSpOB.js";const O=P((s,a)=>({organization:null,currentOrganization:null,members:[],invitedMembers:[],membersCache:{},isLoading:!1,isMembersLoading:!1,error:null,fetchUserOrganizations:async r=>{try{s({isLoading:!0,error:null});const t=await fetch("https://workers.retroui.dev/organizations").then(n=>n.json());s({organization:t,isLoading:!1})}catch(t){s({error:t,isLoading:!1})}},fetchOrganizationMembers:async(r,t)=>{const n=a(),l=300*1e3,o=n.membersCache[t];if(o&&Date.now()-o.lastFetched<l){s({members:o.members});return}try{s({isMembersLoading:!0,error:null});const{members:c,invitedMembers:d}=await fetch(`https://workers.retroui.dev/organizations/${t}/members`).then(g=>g.json());s({members:c,invitedMembers:d,isMembersLoading:!1,membersCache:{...n.membersCache,[t]:{members:c,lastFetched:Date.now()}}})}catch(c){s({error:c,isMembersLoading:!1})}},setCurrentOrganization:r=>{s({currentOrganization:r})}}));function W({organizationId:s,organization:a}){const{fetchUserOrganizations:r}=O(),{token:t}=D(),[n,l]=u.useState({name:a.name||"",website:a.websiteUrl||""});u.useEffect(()=>{l({name:a.name||"",website:a.websiteUrl||""})},[a]);const o=S({mutationFn:async()=>{if(!s)throw new Error("No organization ID");if(!t)throw new Error("Unauthorized!");await fetch("https://workers.retroui.dev/organization/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({organizationId:s,name:n.name,websiteUrl:n.website||null})}).then(d=>d.json()),r(t)}}),c=async d=>{d.preventDefault();try{await o.mutateAsync(),x.success("Organization updated")}catch{x.error("Failed to update organization")}};return e.jsx(m,{className:"w-full bg-white shadow-none p-2",children:e.jsx("form",{onSubmit:c,children:e.jsxs(m.Content,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"name",className:"block",children:"Organization Name"}),e.jsx(z,{id:"name",name:"name",value:n.name,onChange:d=>l({...n,name:d.target.value}),placeholder:"Your name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"website",className:"block",children:"Website"}),e.jsx(z,{id:"website",name:"website",value:n.website,onChange:d=>l({...n,website:d.target.value}),placeholder:"https://company.com"})]})]}),e.jsx("div",{className:"flex flex-row gap-4",children:e.jsx(y,{type:"submit",disabled:o.isPending,children:o.isPending?"Saving...":"Update"})})]})})})}const X=V,F=A,Y=v(` fixed bg-black/80 font-head
    data-[state=open]:fade-in-0
    data-[state=open]:animate-in 
    data-[state=closed]:animate-out 
    data-[state=closed]:fade-out-0 
  `,{variants:{variant:{default:"inset-0 z-50 bg-black/85",none:"fixed bg-transparent"}},defaultVariants:{variant:"default"}}),L=T.forwardRef(function(a,r){const{variant:t="default",className:n,...l}=a;return e.jsx(_,{className:f(Y({variant:t}),n),ref:r,...l})});L.displayName="DialogBackdrop";const q=v(`fixed left-[50%] top-[50%] z-50 grid rounded overflow-hidden w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 bg-background shadow-lg duration-200 
  data-[state=open]:animate-in 
  data-[state=open]:fade-in-0 
  data-[state=open]:zoom-in-95 
  data-[state=closed]:animate-out 
  data-[state=closed]:fade-out-0 
  data-[state=closed]:zoom-out-95`,{variants:{size:{auto:"max-w-fit",sm:"lg:max-w-[30%]",md:"lg:max-w-[40%]",lg:"lg:max-w-[50%]",xl:"lg:max-w-[60%]","2xl":"lg:max-w-[70%]","3xl":"lg:max-w-[80%]","4xl":"lg:max-w-[90%]",screen:"max-w-[100%]"}},defaultVariants:{size:"auto"}}),E=T.forwardRef(function(a,r){const{children:t,size:n="auto",className:l,overlay:o,...c}=a;return e.jsxs(H,{children:[e.jsx(L,{...o}),e.jsxs(I,{className:f(q({size:n}),l),ref:r,...c,children:[e.jsx(J,{children:e.jsx($,{})}),e.jsx("div",{className:"flex flex-col relative",children:t})]})]})});E.displayName="DialogContent";const G=({children:s,className:a,...r})=>e.jsx(B,{className:f(a),...r,children:s}),K=v("flex items-center justify-end border-t-2 min-h-12 gap-4 px-4 py-2",{variants:{variant:{default:"bg-background text-foreground"},position:{fixed:"sticky bottom-0",static:"static"}},defaultVariants:{position:"fixed"}}),Q=({children:s,className:a,position:r,variant:t,...n})=>e.jsx("div",{className:f(K({position:r,variant:t}),a),...n,children:s}),Z=v("flex items-center justify-between border-b-2 px-4 min-h-12",{variants:{variant:{default:"bg-primary text-primary-foreground"},position:{fixed:"sticky top-0",static:"static"}},defaultVariants:{variant:"default",position:"static"}}),ee=({children:s})=>e.jsxs(e.Fragment,{children:[s,e.jsx(F,{title:"Close pop-up",className:"cursor-pointer",asChild:!0,children:e.jsx(R,{})})]}),ae=({children:s,className:a,position:r,variant:t,asChild:n,...l})=>e.jsx("div",{className:f(Z({position:r,variant:t}),a),...l,children:n?s:e.jsx(ee,{children:s})}),b=Object.assign(X,{Trigger:F,Header:ae,Content:E,Description:G,Footer:Q});function se({organizationId:s}){const{token:a}=D(),{members:r,invitedMembers:t,isMembersLoading:n,fetchOrganizationMembers:l}=O(),[o,c]=u.useState(""),[d,g]=u.useState(!1);u.useEffect(()=>{a&&s&&r.length===0&&l(a,s)},[a,s]);const p=S({mutationFn:async i=>{if(!a)throw new Error("Not authenticated");return await fetch("https://workers.retroui.dev/organization/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({organizationId:s,email:i})}).then(w=>w.json())},onSuccess:()=>{x.success("Invitation sent successfully!"),c(""),g(!1),a&&l(a,s)},onError:i=>{const w=(i==null?void 0:i.message)||"Failed to send invitation";x.error(w)}}),U=()=>{if(!o.trim())return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){x.error("Please enter a valid email address");return}p.mutate(o.trim())};return n?e.jsx(m,{className:"w-full bg-white shadow-none hover:shadow-none p-2",children:e.jsx(m.Content,{className:"p-6 text-center",children:e.jsx(h,{children:"Loading members..."})})}):e.jsxs(m,{className:"w-full bg-white shadow-none hover:shadow-none p-2",children:[e.jsxs(m.Header,{className:"flex flex-row items-center justify-between",children:[e.jsx(m.Title,{children:"Team Members"}),e.jsxs(b,{open:d,onOpenChange:g,children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx(y,{size:"sm",children:"Add Member"})}),e.jsxs(b.Content,{size:"md",className:"border-black bg-white rounded-lg",children:[e.jsx(b.Header,{children:e.jsx(h,{as:"h4",children:"Invite Team Member"})}),e.jsx("form",{onSubmit:i=>{i.preventDefault(),U()},children:e.jsxs("div",{className:"px-4 py-12 flex items-end gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(C,{htmlFor:"email",children:"Email Address"}),e.jsx(z,{id:"email",type:"email",placeholder:"colleague@company.com",value:o,onChange:i=>c(i.target.value),disabled:p.isPending})]}),e.jsx(y,{type:"submit",className:"w-38",disabled:!o.trim()||p.isPending,children:p.isPending?"Sending...":"Send Invite"})]})})]})]})]}),e.jsx(m.Content,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[r.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(k,{className:"w-12 h-12 border-2",...M(i.email||"User")}),e.jsxs("div",{children:[e.jsx(h,{as:"h5",className:"font-normal text-lg",children:i.name||""}),e.jsx(h,{className:"text-muted-foreground font-medium",children:i.email||"No email"})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(N,{variant:"solid",children:i.role})})]},i.id)),t.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(k,{className:"w-12 h-12 border-2",...M(i.email||"User")}),e.jsx("div",{children:e.jsx(h,{as:"h5",className:"font-normal text-lg",children:i.email||""})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{variant:"solid",children:i.role}),e.jsx(N,{variant:"solid",className:"bg-red-300",children:"Pending"})]})]},i.id))]})})]})}function le(){const{token:s}=D(),{organization:a,fetchUserOrganizations:r,isLoading:t,error:n}=O();return u.useEffect(()=>{s&&!a&&!t&&r(s)},[s,a,t]),t?e.jsx("div",{className:"min-h-screen w-full flex justify-center items-center",children:e.jsx(j,{children:"Loading organization..."})}):n||!a?e.jsx("div",{className:"min-h-screen w-full flex justify-center items-center",children:e.jsx(j,{children:"Unable to load organization"})}):e.jsx("div",{className:"min-h-screen w-full flex justify-center px-4 mt-10",children:e.jsxs("div",{className:"w-full max-w-3xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(j,{as:"h2",children:"Organization Settings"}),e.jsx(j,{className:"text-muted-foreground font-medium mt-1",children:"Manage your team and organization settings"})]}),e.jsxs("div",{className:"space-y-6",children:[a&&e.jsx(W,{organizationId:a.id,organization:a}),(a==null?void 0:a.id)&&e.jsx(se,{organizationId:a.id})]})]})})}export{le as component};
